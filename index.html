<!DOCTYPE html>
<html>
  <head>
    <title>Revolvapp</title>
    <meta charset="utf-8" />

    <!-- revolvapp css -->
    <link rel="stylesheet" href="./css/revolvapp.css" />
    <link rel="stylesheet" href="/plugins/variable/variable.css" />
    <script
      src="https://kit.fontawesome.com/261503e59d.js"
      crossorigin="anonymous"
    ></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:wght@700&family=Roboto:wght@100;400;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- element -->
    <div class="master-bar">
      <div class="master-bar-inner">
        <div>
          <button class="next">Save and Continue</button>
        </div>
        <nav>Editing Invoice</nav>
        <div class="prev-wrapper">
          Close and back to menu
          <button class="prev"><img src="./icons/close.png" /></button>
        </div>
      </div>
    </div>
    <div id="myemail"></div>

    <div class="rex-popup-default">Select a component</div>

    <!-- revolvapp js -->
    <script src="revolvapp.js"></script>
    <script src="/plugins/add/add.js"></script>
    <script src="/plugins/variable/variable.js"></script>
    <script src="/plugins/code/code.js"></script>
    <script src="/plugins/style/style.js"></script>
    <script src="/plugins/reorder/reorder.js"></script>
    <script src="/pv-blocks/upcoming-events.js"></script>

    <!-- new plugins-->
    <script src="/plugins/templates/templates.js"></script>
    <script src="/plugins/undo/undo.js"></script>
    <script src="/plugins/save/save.js"></script>
    <script src="/plugins/redo/redo.js"></script>

    <!-- call -->
    <script>
      function getHtml(action) {
        var app = Revolvapp("#myemail");
        var html = app.editor.getHtml();

        var body = app.editor.getTemplate();

        var updateMethod;
        switch ("newsletter") {
          case "content":
            updateMethod = "updatePage";
            dataObject = {
              page: {
                page_no: 0,
                archivePrevious: true,
                page_status: "active",
                updateFields:
                  "page_status, page_content, template_fields, template_no",
                template_no: -1,
                template_fields: body,
                page_content: html,
              },
            };
            break;
          case "newsletter":
            updateMethod = "updateNewsletter";
            dataObject = {
              newsletter: {
                newsletter_no: 30461,
                updateFields: "newsletter_body, template_fields, template_no",
                newsletter_body: html,
                template_fields: body,
                template_no: -1,
              },
            };
            break;
        }

        ajaxCall({
          type: "POST",
          url: "/methods.asmx/" + updateMethod,
          data: dataObject,
          success: function (response) {
            var result = JSON.parse(response).d;
            // Optional Success Callback
            console.log(result);
          },
          fail: function (http) {
            // Optional Fail Callback
            console.log(http);
          },
          always: function (http) {
            // Optional Always Callback
            console.log(http);
          },
        });
      }

      Revolvapp("#myemail", {
        plugins: [
          //"add",
          "variable",
          "reorder",
          "code",
          //"templates",
          "style",
          "undo",
          "save",
          "redo",
        ],
        style: {
          styles: {
            block: {
              shadow: {
                title: "Shadow",
                css: {
                  "box-shadow": "0 20px 30px rgba(0, 0, 0, .3)",
                },
              },
              dark: {
                title: "Dark",
                css: {
                  "background-color": "#111",
                  color: "#eee",
                  "link-color": "#fff",
                },
              },
            },
          },
        },
        variable: {
          items: ["email", "first_name", "last_name"],
        },
        editor: {
          font: "Open Sans, Helvetica, sans-serif",
          path: "./",
          template: "./templates/index.html",
        },
      });
    </script>
  </body>
</html>
